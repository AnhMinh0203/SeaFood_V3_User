<app-navbar></app-navbar>
<div class="container my-3">
    <div class="d-flex justify-content-center mt-5 my-3">
        <h3>Giỏ hàng</h3>
    </div>
    <p-table [value]="products" [tableStyle]="{ 'min-width': '60rem' }">
        <ng-template #header>
            <tr>
                <th>Tên sản phẩm</th>
                <th>Ảnh</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Tổng</th>
                <th>Hành động</th>
            </tr>
        </ng-template>
        <ng-template #body let-product>
            <tr>
                <td>{{ product.name }}</td>
                <td>
                    <img [src]="'https://primefaces.org/cdn/primeng/images/demo/product/' + product.image"
                        [alt]="product.name" style="max-width: 80px; height: auto;" class="rounded" />
                </td>
                <td>{{ product.price | currency:'VND':'symbol':'1.0-0' }}</td>
                <td>
                    <div class="quantity-control">
                        <button (click)="decrementQuantity(product)" class="quantity-btn">
                            <i class="pi pi-minus"></i>
                        </button>
                        <input [(ngModel)]="product.quantity" (change)="validateQuantity(product)"
                            class="quantity-input">
                        <button (click)="incrementQuantity(product)" class="quantity-btn">
                            <i class="pi pi-plus"></i>
                        </button>
                    </div>
                </td>
                <td>{{ calculateTotal(product) | currency:'VND':'symbol':'1.0-0' }}</td>
                <td>
                    <i class="pi pi-trash" (click)="removeProduct(product)"></i>
                </td>
            </tr>
        </ng-template>
        <ng-template #footer>
            <tr>
                <td colspan="4" class="text-right font-bold">Tổng cộng:</td>
                <td class="font-bold">{{ calculateGrandTotal() | currency:'VND':'symbol':'1.0-0' }}</td>
                <td></td>
            </tr>
        </ng-template>
    </p-table>
    <div class="d-flex gap-2 justify-content-end my-3">
        <p-button label="Tiếp tục mua sắm" styleClass="w-100" severity="success" />
        <p-button label="Xác nhận đơn hàng" styleClass="w-100" severity="danger" (click)="openOrderConfirmation()" />
    </div>
</div>

<app-submit-order-form 
    [(visible)]="showOrderForm" 
    [orderData]="{ total: calculateGrandTotal(), products: products }"
    (onHide)="closeOrderConfirmation()">
</app-submit-order-form>